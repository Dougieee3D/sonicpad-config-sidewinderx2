MOONRAKER + MACROS FOR KLIPPER-BACKUP
=====================================

1) Edit moonraker.conf and ensure the following exists:

[authorization]
trusted_clients:
    172.22.0.0/16
    10.0.0.0/8
    127.0.0.0/8
    169.254.0.0/16
    172.16.0.0/12
    192.168.0.0/16
    FE80::/10
    ::1/128
cors_domains:
    *.lan
    *.local
    *://localhost
    *://localhost:*
    *://my.mainsail.xyz
    *://app.fluidd.xyz
trusted_methods:
    machine.shell_command

# (The 'trusted_methods' line is the important addition.)

2) Also add (or keep) the update_manager entry for klipper-backup:

[update_manager klipper-backup]
type: git_repo
path: ~/klipper-backup
origin: https://github.com/Staubgeborener/klipper-backup.git
managed_services: moonraker
primary_branch: main

3) Upload 'backup_moonraker_macros.cfg' to your config folder and include it
   from printer.cfg, e.g. near the top:


4) Restart Moonraker + Klipper, or reboot the Sonic Pad.

5) Use in Fluidd console:
   BACKUP_NOW     -> run immediate backup (klipper-backup/scripts/backup.sh)
   BACKUP_STATUS  -> shows the systemd timer (NEXT | LEFT | LAST | PASSED)

6) Make sure the timer is enabled (hourly backups):
   systemctl --user enable klipper-backup.timer
   systemctl --user start klipper-backup.timer
   systemctl --user list-timers klipper-backup.timer
